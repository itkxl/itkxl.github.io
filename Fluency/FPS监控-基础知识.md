## 一、引言
在日常App开发过程中，流畅的视觉体验是用户满意的基本保证。要实现这一点，需要对现实相关的内容，比如帧缓冲区、刷新率、帧率等有一个基本的认识。在本文中，我们将简单概述一下这些基本概念以及在Android平台上的实现，帮助后续相关监控能力的建设。

## 二、显示基础

### 2.1 刷新率 
在购买手机和显示器的时候，这是一个很重要的硬件参数。刷新率高意味着可以每秒钟更新更多次画面，之前的手机大多数为60Hz，即每秒钟刷新60次。随着技术发展，越来越多的设备开始采用更高的帧率，如90Hz,120Hz等，这样可以让屏幕显示的和动效更加平滑，减少视觉延迟&卡顿。
### 2.2 帧率
帧率，一般使用FPS(每秒帧数)，描述每秒钟能生成多少个页面，由CPU&GPU完成。

### 2.3 刷新率与帧率的区别
两者概念听起来较为相近，但是却有本质区别，两者更像是生产者和消费者的关系。
- 帧率：生产者，负责生成帧供屏幕进行展示，或者说供刷新率进行消费（可能说成生产者的速度更为恰当一些）。
- 刷新率：消费者，消费生成的帧的速度。

### 2.3 FrameBuffer
帧的生产和消费之间需要一个桥梁，其就是FrameBuffer。它本质上是一块内存区域，它用来临时存储整个屏幕即将显示的像素数据。

### 2.4 问题
前面介绍了刷新率、帧率、FrameBuffer的基本概念，刷新率和帧率是两个速度，既然是速度，可能出现值不匹配的情况。
- 刷新率高于帧率：当显示设备的刷新率（屏幕每秒更新的次数）高于帧率（设备每秒生成的画面数）时，屏幕有时候会不得不重复同事同一帧画面，直到下一帧准备好为止。会造成卡顿感。
- 帧率高于刷新率：当帧率高于刷新率，每秒生成的次数超过了屏幕每秒能更新的次数，这可能造成单次刷新期间FrameBuffer中同时有多个帧的信息，这将导致一个常见的问题，屏幕撕裂。

如何解决上述两者不同步的问题呢？接下来介绍垂直同步技术。

## 三、垂直同步（VSync）
### 3.1 什么是VSync?
VSync，全称Vertical Synachronization（垂直同步），是用来解决屏幕撕裂问题的一种技术。屏幕撕裂是指显示设备在刷新内容时，上一帧的内容与新一帧的内容不同步，造成的屏幕上部分区域显示上一帧的图片，而另外一部分显示的是新帧图像的现象。

### 3.2 VSync的工作原理
VSync的工作原理是将应用的图形渲染操作与显示器的刷新率进行同步。大多数的设备的显示器的刷新率是60Hz,即每秒刷新60次。开启VSync后，应用的渲染速度会被锁定，以确保每次渲染的结果都在显示器准备刷新的时候完成，减少撕裂现象。
换句话说，VSync作用是确保GPU每次只在显示器准备好接收新帧时才发送帧。它会限制GPU发送新帧的时间点，必须与显示器的刷新周期对齐。当GPU完成一帧的渲染时，它不会立刻将这帧送到显示器，而是等到显示器下一次刷新周期开始时，才发送这帧到显示器。这样可以保证显示器在一个刷新周期内只显示了一帧图像，避免了撕裂。
从Android角度来看，VSync需要做的事情是产生VSync信号，通知CPU/GPU立刻开始生成下一帧，通知GPU从FrameBuffer中奖当前帧post到显示器，即生成帧时机必须和Vsync信号保持同步。

### 3.3 VSync的限制
- 输入延迟：由于GPU需要等待显示器的刷新周期，这可能导致输入相应有稍微延迟。这对于游戏应用来说，影响比较严重。
- 帧率下降：如果GPU不能及时完成帧的渲染以匹配每个刷新周期，帧率可能会下降。

在当仅有一个FrameBuffer并且启用Vsync的配置，虽然可以避免屏幕撕裂来提升图像质量，但其也带来性能上的损失，如增加延迟，帧率不稳定等。多FrameBuffer技术的引入，能够有效缓解这些问题，提供更加优秀的

## 四、多缓冲技术

## 五、Anrdoid Choreographer